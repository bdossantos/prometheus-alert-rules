---
# Code generated by Sloth (v0.11.0): https://github.com/slok/sloth.
# DO NOT EDIT.

groups:
  - name: sloth-slo-sli-recordings-ads-requests-availability
    rules:
      - record: slo:sli_error:ratio_rate5m
        expr: |
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads",code=~"[5].*"}[5m])))
          /
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads"}[5m])))
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 5m
      - record: slo:sli_error:ratio_rate30m
        expr: |
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads",code=~"[5].*"}[30m])))
          /
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads"}[30m])))
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 30m
      - record: slo:sli_error:ratio_rate1h
        expr: |
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads",code=~"[5].*"}[1h])))
          /
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads"}[1h])))
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 1h
      - record: slo:sli_error:ratio_rate2h
        expr: |
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads",code=~"[5].*"}[2h])))
          /
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads"}[2h])))
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 2h
      - record: slo:sli_error:ratio_rate6h
        expr: |
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads",code=~"[5].*"}[6h])))
          /
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads"}[6h])))
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 6h
      - record: slo:sli_error:ratio_rate1d
        expr: |
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads",code=~"[5].*"}[1d])))
          /
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads"}[1d])))
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 1d
      - record: slo:sli_error:ratio_rate3d
        expr: |
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads",code=~"[5].*"}[3d])))
          /
          (sum(rate(haproxy_backend_http_responses_total{proxy="ads"}[3d])))
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 3d
      - record: slo:sli_error:ratio_rate30d
        expr: |
          sum_over_time(slo:sli_error:ratio_rate5m{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"}[30d])
          / ignoring (sloth_window)
          count_over_time(slo:sli_error:ratio_rate5m{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"}[30d])
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_window: 30d
  - name: sloth-slo-meta-recordings-ads-requests-availability
    rules:
      - record: slo:objective:ratio
        expr: vector(0.9990000000000001)
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
      - record: slo:error_budget:ratio
        expr: vector(1-0.9990000000000001)
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
      - record: slo:time_period:days
        expr: vector(30)
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
      - record: slo:current_burn_rate:ratio
        expr: |
          slo:sli_error:ratio_rate5m{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"}
          / on(sloth_id, sloth_slo, sloth_service) group_left
          slo:error_budget:ratio{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"}
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
      - record: slo:period_burn_rate:ratio
        expr: |
          slo:sli_error:ratio_rate30d{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"}
          / on(sloth_id, sloth_slo, sloth_service) group_left
          slo:error_budget:ratio{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"}
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
      - record: slo:period_error_budget_remaining:ratio
        expr:
          1 - slo:period_burn_rate:ratio{sloth_id="ads-requests-availability", sloth_service="ads",
          sloth_slo="requests-availability"}
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_service: ads
          sloth_slo: requests-availability
      - record: sloth_slo_info
        expr: vector(1)
        labels:
          repo: https://github.com/bdossantos/prometheus-alert-rules
          sloth_id: ads-requests-availability
          sloth_mode: cli-gen-prom
          sloth_objective: "99.9"
          sloth_service: ads
          sloth_slo: requests-availability
          sloth_spec: prometheus/v1
          sloth_version: v0.11.0
  - name: sloth-slo-alerts-ads-requests-availability
    rules:
      - alert: AdsHighErrorRate
        expr: |
          (
              max(slo:sli_error:ratio_rate5m{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (14.4 * 0.0009999999999999432)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate1h{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (14.4 * 0.0009999999999999432)) without (sloth_window)
          )
          or
          (
              max(slo:sli_error:ratio_rate30m{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (6 * 0.0009999999999999432)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate6h{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (6 * 0.0009999999999999432)) without (sloth_window)
          )
        labels:
          severity: page
          sloth_severity: page
        annotations:
          summary:
            "{{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget burn
            rate is over expected."
          title:
            (page) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
            burn rate is too fast.
      - alert: AdsHighErrorRate
        expr: |
          (
              max(slo:sli_error:ratio_rate2h{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (3 * 0.0009999999999999432)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate1d{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (3 * 0.0009999999999999432)) without (sloth_window)
          )
          or
          (
              max(slo:sli_error:ratio_rate6h{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (1 * 0.0009999999999999432)) without (sloth_window)
              and
              max(slo:sli_error:ratio_rate3d{sloth_id="ads-requests-availability", sloth_service="ads", sloth_slo="requests-availability"} > (1 * 0.0009999999999999432)) without (sloth_window)
          )
        labels:
          sloth_severity: ticket
        annotations:
          summary:
            "{{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget burn
            rate is over expected."
          title:
            (ticket) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
            burn rate is too fast.
