---
groups:
  - name: blackbox
    rules:
      - alert: UrlProbeFailed
        expr: probe_success != 1
        for: 1m
        labels:
          scope: blackbox
          severity: page
        annotations:
          description: "{{ $labels.url }} probe failed"
          summary: URL Probe Failed
      - alert: UrlProbeSlow
        expr: probe_http_duration_seconds > 1
        for: 5m
        labels:
          scope: blackbox
          severity: critical
        annotations:
          description: "{{ $labels.url }} probe slow ({{ $value }}s)"
          summary: URL Probe Slow
      - alert: DnsLookupTimeProbeSlow
        expr: probe_dns_lookup_time_seconds > 0.2
        for: 1m
        labels:
          scope: blackbox
          severity: critical
        annotations:
          description: "{{ $labels.url }} probe slow ({{ $value }}s)"
          summary: DNS lookup time Probe Slow
      - alert: SSLCertExpiringSoon
        expr: probe_ssl_earliest_cert_expiry - time() < 86400 * 30
        for: 10m
        labels:
          scope: blackbox
          severity: page
        annotations:
          description: "Renew SSL cert of {{ $labels.url }} !"
          summary: SSL Cert Expiring Soon
      - alert: BlackboxSslCertificateExpired
        expr: probe_ssl_earliest_cert_expiry - time() <= 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Blackbox SSL certificate expired (instance {{ $labels.instance }})"
          description: "SSL certificate has expired already\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"
      - alert: BlackboxProbeSlowHttp
        expr: avg_over_time(probe_http_duration_seconds[1m]) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Blackbox probe slow HTTP (instance {{ $labels.instance }})"
          description: "HTTP request took more than 1s\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"
      - alert: BlackboxProbeSlowPing
        expr: avg_over_time(probe_icmp_duration_seconds[1m]) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Blackbox probe slow ping (instance {{ $labels.instance }})"
          description: "Blackbox ping took more than 1s\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"
