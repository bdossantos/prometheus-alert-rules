---
groups:
  - name: md
    rules:
      - alert: HostRaidArrayGotInactive
        expr: (node_md_state{state="inactive"} > 0) * on(instance) group_left (nodename) node_uname_info{nodename=~".+"}
        for: 5m
        labels:
          severity: page
        annotations:
          summary: "Host RAID array got inactive (instance {{ $labels.instance }})"
          description: "RAID array {{ $labels.device }} is in degraded state due to one or more disks failures. Number of spare drives is insufficient to fix issue automatically.\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

      - alert: HostRaidDiskFailure
        expr: (node_md_disks{state="failed"} > 0) * on(instance) group_left (nodename) node_uname_info{nodename=~".+"}
        for: 5m
        labels:
          severity: page
        annotations:
          summary: "Host RAID disk failure (instance {{ $labels.instance }})"
          description: "At least one device in RAID array on {{ $labels.instance }} failed. Array {{ $labels.md_device }} needs attention and possibly a disk swap\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"
      - alert: HostRaidDegraded
        expr: ((node_md_disks_required - on(device, instance) node_md_disks{state="active"}) > 0) * on(instance) group_left (nodename) node_uname_info{nodename=~".+"}
        for: 15m
        labels:
          severity: page
        annotations:
          summary: "Host RAID is degraded (instance {{ $labels.instance }})"
          description: "Host RAID array '{{ $labels.device }}' at {{ $labels.instance }} is in degraded state due to one or more disks failures. Number of spare drives is insufficient to fix issue automatically."
